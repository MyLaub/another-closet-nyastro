---
import Layout from "../layouts/Layout.astro";
import "../css/global.css";

// Hent ID fra URL query param
// const id = new URL(Astro.request.url).searchParams.get("id");

const id = parseInt(new URL(Astro.request.url).searchParams.get("id") || "");

let product = null;

if (id) {
  const res = await fetch(`https://qggjjsozgtvkomdpueyz.supabase.co/rest/v1/AC_Products?id=eq.${id}`, {
    headers: {
      apikey: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFnZ2pqc296Z3R2a29tZHB1ZXl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM3ODY2MDUsImV4cCI6MjA2OTM2MjYwNX0.RsjMI2QZxG6bGmtcxiqUPia_lUJC7ZhaTqofLyeE9Fs",
      Authorization: "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFnZ2pqc296Z3R2a29tZHB1ZXl6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM3ODY2MDUsImV4cCI6MjA2OTM2MjYwNX0.RsjMI2QZxG6bGmtcxiqUPia_lUJC7ZhaTqofLyeE9Fs",
      Accept: "application/json"
    },
  });

  const data = await res.json();
  product = data[0];
}
---

<Layout>
  <!-- <section class="singleview">
    <div class="single-image">
      <img src={`/images/${product.image}`} alt={product.name} />
    </div>

    <div class="product-details">
      <h1>{product.name}</h1>
      <p><strong>MÃ¦rke:</strong> {product.brand}</p>
      <p><strong>StÃ¸rrelse:</strong> {product.size}</p>
      <p><strong>Fit:</strong> {product.fit}</p>
      <p><strong>Vask:</strong> {product.wash}</p>
      <p><strong>Stand:</strong> {product.condition}</p>
      <p><strong>Kommentar:</strong> {product.comment}</p>
    </div>
  </section> -->

  {
    product ? (
      <section class="singleview">
        <div class="single-image">
          <img src={`/images/${product.image}`} alt={product.name} />
        </div>

        <div class="product-details">
          <h1>{product.name}</h1>
          <p>
            <strong>MÃ¦rke:</strong> {product.brand}
          </p>
          <p>
            <strong>StÃ¸rrelse:</strong> {product.size}
          </p>
          <p>
            <strong>Fit:</strong> {product.fit}
          </p>
          <p>
            <strong>Vask:</strong> {product.wash}
          </p>
          <p>
            <strong>Stand:</strong> {product.condition}
          </p>
          <p>
            <strong>Kommentar:</strong> {product.comment}
          </p>
        </div>
      </section>
    ) : (
      <p style="text-align: center; padding: 2rem;">Produkt ikke fundet ðŸ˜•</p>
      <p>ID fra URL: {id}</p>

    )
  }

  <!-- <h2 class="related-heading">Flere ting i {product.location || "samme by"}</h2> -->
  <!-- Her kan du indsÃ¦tte anbefalede produkter senere -->
</Layout>

<style>
  .singleview {
    display: flex;
    flex-wrap: wrap;
    max-width: 1000px;
    margin: 2rem auto;
    gap: 2rem;
    padding: 1rem;
  }

  .single-image {
    flex: 1 1 40%;
  }

  .single-image img {
    width: 100%;
    height: auto;
  }

  .product-details {
    flex: 1 1 50%;
    font-size: 1rem;
    line-height: 1.6;
  }

  .product-details h1 {
    font-size: 1.8rem;
    margin-bottom: 1rem;
  }

  .related-heading {
    text-align: center;
    margin-top: 4rem;
  }
</style>
